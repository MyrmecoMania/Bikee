
<div class="container show-page row">
  <div class="col-4 offset-2">
  <h1 class="text-center mt-3 mb-5">Détails du vélo</h1>
    <div class="card-details p-3 rounded mb-5">
      <div class="card-details-image">
        <% @bike.photos.each do |photo| %>
          <%= cl_image_tag photo.key %>
        <% end %>
      </div>
      <hr class="w-100 py-1">
      <div class="card-details-content">
        <div>
          <p>Type : <%= @bike.category %></p>
          <% if @bike.brand %>
            <p>Marque : <%= @bike.brand %></p>
          <% end %>
          <p>Statuts : <%= @bike.status ? 'Disponible' : 'Indisponible' %></p>
          <p>Adresse : <%= @bike.address %></p>
          <p class="card-detais-price">Prix journalier : <%= @bike.price_per_day %> €</p>
          <hr class="pt-2">
          <div class="d-flex justify-content-around">
            <% if policy(@bike).edit? %>
              <%= link_to "Modifier", edit_bike_path(@bike), class:"btn btn-confirm rounded" %>
            <% end %>
            <% if @bike.user != current_user %>
              <%= simple_form_for [@bike, @rent],
                                  html: {
                                    data: {
                                      controller: 'flatpickr',
                                      flatpickr_dates_value: @bike.flatpickr_booked_dates_object
                                    }
                                  } do |f| %>
                                    <div class="row">
                                      <div class="col-6">
                                        <%= f.input :start_date,
                                                    as: :string,
                                                    html5: true,
                                                    label: "Date de début",
                                                    placeholder: "Date...",
                                                    input_html: {
                                                      data: {
                                                        flatpickr_target: 'startDateInput',
                                                      }
                                                    } %>
                                      </div>
                                      <div class="col-6">
                                        <%= f.input :end_date,
                                                    as: :string,
                                                    html5: true,
                                                    placeholder: "Date...",
                                                    label: "Date de fin",
                                                    input_html: {
                                                      data: {
                                                        flatpickr_target: 'endDateInput'
                                                      }
                                                    } %>
                                      </div>
                                    </div>
                                    <div class="d-flex justify-content-center">
                                      <%= f.submit 'Réserver', class:"btn btn-confirm rounded large p-2" %>
                                    </div>
                                  <% end %>
            <% end %>
            <%= button_to "Supprimer", @bike, method: :delete, class:"btn btn-confirm rounded" if policy(@bike).destroy? %>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="col-6">
  <h1 class="text-center mt-3 mb-5 pb-5">Renting offers</h1>
    <div class="card-details p-3 rounded mb-5">
      <% if current_user == @bike.user %>
        <% @bike.rents.each do |rent| %>
          <%= rent.start_date %>
          <%= rent.end_date %>
          <p><%= rent.user.email%></p>
          <% if rent.status == "waiting" %>
            <button class="btn btn-danger">Accept</button>
            <button class="btn btn-danger">Decline</button>
          <% elsif rent.status == "accepted" %>
            <h4>Accepted</h4>
          <% else %>
            <h4>Declined</h4>
          <% end %>
        <% end %>
      <% else %>
       <div  style="width: 500px; height: 500px" data-controller="map"
        data-map-markers-value="<%= @markers.to_json %>"
        data-map-api-key-value="<%= ENV['MAPBOX_API_KEY'] %>">
        </div>
      <% end %>
    </div>
  </div>
</div>
